# 连不上校园网及其解决办法

许多人在人流量较大的教学楼都经历过以下情况：使用Windows10系统连接SCUNET，但是一直连接不上，即使显示连接上，但是仍然无法跳出认证界面。手机则是一直显示无法连接到SCUNET，显示“正在获取ip地址”。

<div align="center">
  <img src="/assets/web认证原理.jpg"/>
  <p>锐捷web认证原理</p>
</div>

无法获取到正确的IP，就没法进行web认证的第一步：发送HTTP请求。那么是什么原因导致了各位连接不上校园网呢？其实原因很简单，是因为IP池中的IP分配完了，所以导致新连接的设备无法取得IP。即僧多粥少。

但是，你在这种情况下，找一台已经连接到SCUNET的设备，扫描内网的IP地址，有时候你会发现，一部分IP地址都是未分配的状态。甚至有一半的地址都是待分配的状态。这是为什么呢？

为了解释出现这一现象的原因，我们先了解一下获取IP的过程：当你的设备连接SCUNET的时候，会先向DHCP服务器发送请求分配一个IP的报文，当DHCP服务器检查到此时IP池内还有没有分配出去的IP时，就会给你分配一个IP地址，并与你的设备签下一个地址租约，在租约时间内，你的设备拥有该IP地址的使用权，即使你的设备断开连接，只要在租约时间内重新连接，分配的IP就是不变的，别人无法抢占你的IP地址。当租约时间过了一半后如果设备还在线，就会自动发送一次续约报文，请求DHCP服务器将使用权时间延长。

SCUNET的租约时间为2小时，这是在公共场所通用的一个时间配置。但是，教学楼的人实在太多了，并且由于教育场所的特殊性，短时间内交替的流量也十分巨大。

于是问题就跟着来了。在大课间这种即将上课，人流交替的流量很大的时候，许多准备离开教室的人断开了他们的SCUNET，但是由于DHCP租约时间未到，所以他们继续占用着之前分配的IP的使用权，此时，IP池内所剩的可分配IP已经所剩无几，下一波来上课的人已经来到了教室，一部分先采取行动的人抢先连上了SCUNET，于是此时系统最后一点能分配的IP也用完了，即使已经有IP未被分配，但是实际上租约未到期，系统仍然拿不到该IP的使用权，于是就没法为后来的设备分配新IP了，这也就是在你即将上晚课的时候死活连接不上校园网但是等了几十分钟又自己能够连上的原因。从18:25分到19:20仅有55分钟时间，而根据上述所知，几乎所有设备断开网络时的剩余租约都在1小时及以上，抢不到少数还未分配的IP的话，就干等着吧。

改善这个状况的一个较为有效的措施就是继续调小SCUNET的租约时间，但是似乎信息管理中心并没有这样做，导致在综C这种大教室教学楼校园网体验很差。

在Windows10系统中，有人给自己的无线网络开启了随机硬件地址这个选项，此功能的开启会导致你在每次连接WIFI的时候使用不同的身份标志，也就意味着DHCP服务器会把你当做新设备，所以在无可分配IP的情况下，当你断开网络再重新连接时，就会连接不上。此功能的使用也会加速消耗完网内可用IP数，不利于自己断网重连（后面解释你为什么可能需要断网重连），也不利于IP的高效利用，所以通常不建议各位开启。

<div align="center">
  <img src="/assets/随机硬件地址.jpg"/>
  <p>随机硬件地址功能</p>
</div>

那么有没有什么办法可以从自己的设备着手解决连接不上的情况呢？

有传言称可以这样做：在人少的综合B座先连上SCUNET，然后缓步走到综合楼C座，由于SCUNET的AP具有所谓的“桥接”功能，然后你就可以正常在综C使用了。

有用么？理论上是有的，因为综B和综C是一张网，所以你不管在哪儿连上都是在一张网内随便用，但是也正是因为一张网，所以基本上在综C连不上时，你在综B也一样连不上，你在综B能连上的同一时刻，在综C也是一样能连上的。

还有什么其他办法么？有的。

手动分配静态IP。也就是说，你给自己的设备手动指定一个合法的IP，强制性的将租约时间未到的设备的IP分配到你的设备（强取）。成功之后你就可以弹出认证界面了，如果仍然无法弹出，浏览器手动输入192.168.2.135即可。

值得注意的是，如果你自行指定的IP地址是正在被使用的IP，那么你将无法强取该IP，也就没法打开认证界面了。不过没关系，靓仔千千万，不行咱就换。

有许多人换了许多次依然不能正常打开认证界面，是因为多次选择的IP是正在被使用的IP，为什么选择到的IP是正在被使用的概率这么大？

你以为你连接不上校园网就只有DHCP租约时间在作祟么，不止，楼宇本身的IP资源不够多也是原因之一。查看下面的SCUNET参数表你可以发现，对于综合楼C座这种大教室的教学楼，竟然是和综合楼B座共享约1024个IP地址。而一教则要好一些，四栋楼共享约4096个地址。

所以在本身资源就稀缺的情况下，高峰时段这些大楼能够空出来的位子本来就比其他地方少，连不上也就不奇怪了。

在这种情况下，有两种方法可以提高你设置静态后成功连接网络的概率，第一种是找一台已经连接了校园网的机器，扫描你所在的大楼所用的网段下的空闲IP，你可以使用众多工具完成扫描，例如Windows可以使用[Advanced IP Scanner](http://www.advanced-ip-scanner.com/cn/)等软件。这种寻找空闲IP的方法基本百发百中，所以推荐使用，你可以找一台任意的机器完成扫描，只要它能够访问校园内网即可，甚至你可以更进一步，让这台机器能够随时依据你的指令扫描并通过公网反馈给你，而这就是另一个故事了。第二种就是不够人道的做法了，通过攻击无线AP，强行将已经连接了的设备“踢”下线从而释放一部分IP，提高自己成功连接的概率。而这也可能是你在连接了SCUNET后莫名就掉了线的原因之一（这也是上文提到的你可能需要重连的原因）。由于此方法并不人道，所以并不会介绍如何执行。

为了减少自己被可能存在的攻击的影响，你应当尽量连接5GHz频段的WiFi。例如Windows10中，进入网络适配器选项中，找到自己的无线网卡，右击选择属性，在WLAN属性里，点击Microsoft网络客户端，点击配置，选择高级选项卡，在“属性”里的“首选频带”里，选择首选5GHz频带。保存设置。

<div align="center">
  <img src="/assets/首选5G.jpg"/>
  <p>首选5GHz频带</p>
</div>

如果你已经知道一个未被使用的IP后，按照相关方法设置就行。网络上已经有大量的设置静态IP的方法，针对自己的系统设置即可。以win10和Android为例：

#### Android
在连接的WiFi名字附近有详情设置按钮，点进去，在IP设置里将DHCP改为手动，然后依次设置你想分配的IP地址、路由器（网关地址）、前缀长度、主DNS、备用DNS地址即可。

<div align="center">
  <img src="/assets/手机静态1.jpg"/>
  <p>Android设置静态IP</p>
</div>

#### Windows10
在连接的WiFi名字右击，点进属性，在IP分配设置里将自动DHCP改为手动，然后依次设置你想分配的IP地址、路由器（网关地址）、前缀长度、主DNS、备用DNS地址即可。

<div align="center">
  <img src="/assets/win静态1.jpg"/>
</div>

<div align="center">
  <img src="/assets/win静态2.jpg"/>
  <p>Windows10设置静态IP</p>
</div>

### 设置参数
- IP地址，在对应大楼的SCUNET子网地址中随机指定，直到能正常打开认证界面为止。
- 子网前缀长度（有的地方是子网掩码）：按照对应大楼的SCUNET参数填写。
- 网关：在对应大楼的SCUNET网关。
- DNS：主DNS:	202.115.32.39  备用：202.115.32.36

### 江安SCUNET参数


|地点|路由网关|子网前缀长度（约多少可分配IP数）|IP地址范围|
|:-:|:-:|:-:|:-:|
|一教ABCD|10.132.15.254|20（4096）|10.132.0.2-10.132.15.253|
|建环学院|10.132.19.254|22（1024）|10.132.16.1-10.132.19.253|
|文科楼|10.132.23.254|22（1024）|10.132.20.1-10.132.23.253|
|法学院|10.132.27.254|22（1024）|10.132.24.1-10.132.27.253|
|江安图书馆|10.132.31.254|22（1024）|10.132.28.1-10.132.31.253|
|新能源研究院|10.132.32.254|24（256）|10.132.32.1-10.132.32.253|
|？|10.132.35.254|22（768）|10.132.33.1-10.132.35.253|
|综合楼|10.132.39.254|22（1024）|10.132.36.1-10.132.39.253|
|江安校医院|10.132.40.254|24（256）|10.132.40.1-10.132.40.253|
|二餐|10.132.41.254|24（256）|10.132.41.1-10.132.41.253|
|？|10.132.42.254|24（256）|10.132.42.1-10.132.42.253|
|一餐|10.132.43.254|24（256）|10.132.43.1-10.132.43.253|
|二号体育场|10.132.44.254|24（256）|10.132.44.1-10.132.44.253|
|江安体育馆|10.132.45.254|24（256）|10.132.45.1-10.132.45.253|
|？|10.132.46.254|24（256）|10.132.46.1-10.132.46.253|
|？|10.132.47.254|24（256）|10.132.47.1-10.132.47.253|
|二基楼|10.132.51.254|22（1024）|10.132.48.1-10.132.51.253|
|一基楼|10.132.55.254|22（1024）|10.132.52.1-10.132.55.253|
|行政楼（SCUNET-XZ）|10.132.57.254|23（512）|10.132.56.1-10.132.57.253|
|工程训练中心|10.132.96.254|24（256）|10.132.96.1-10.132.96.253|


.



附录：子网掩码与子网前缀长度对应表：

<table border='0' cellspacing='0' cellpadding='2' width='15%' align='center'>
<tbody> <tr> <td>子网前缀长度</td> <td>子网掩码</td> </tr>
<tr> <td>1</td> <td>128.0.0.0</td> </tr>
<tr> <td>2</td> <td>192.0.0.0</td> </tr>
<tr> <td>3</td> <td>224.0.0.0</td> </tr>
<tr> <td>4</td> <td>240.0.0.0</td> </tr>
<tr> <td>5</td> <td>248.0.0.0</td> </tr>
<tr> <td>6</td> <td>252.0.0.0</td> </tr>
<tr> <td>7</td> <td>254.0.0.0</td> </tr>
<tr> <td>8</td> <td>255.0.0.0</td> </tr>
<tr> <td>9</td> <td>255.128.0.0</td> </tr>
<tr> <td>10</td> <td>255.192.0.0</td> </tr>
<tr> <td>11</td> <td>255.224.0.0</td> </tr>
<tr> <td>12</td> <td>255.240.0.0</td> </tr>
<tr> <td>13</td> <td>255.248.0.0</td> </tr>
<tr> <td>14</td> <td>255.252.0.0</td> </tr>
<tr> <td>15</td> <td>255.254.0.0</td> </tr>
<tr> <td>16</td> <td>255.255.0.0</td> </tr>
<tr> <td>17</td> <td>255.255.128.0</td> </tr>
<tr> <td>18</td> <td>255.255.192.0</td> </tr>
<tr> <td>19</td> <td>255.255.224.0</td> </tr>
<tr> <td>20</td> <td>255.255.240.0</td> </tr>
<tr> <td>21</td> <td>255.255.248.0</td> </tr>
<tr> <td>22</td> <td>255.255.252.0</td> </tr>
<tr> <td>23</td> <td>255.255.254.0</td> </tr>
<tr> <td>24</td> <td>255.255.255.0</td> </tr>
<tr> <td>25</td> <td>255.255.255.128</td> </tr>
<tr> <td>26</td> <td>255.255.255.192</td> </tr>
<tr> <td>27</td> <td>255.255.255.224</td> </tr>
<tr> <td>28</td> <td>255.255.255.240</td> </tr>
<tr> <td>29</td> <td>255.255.255.248</td> </tr>
<tr> <td>30</td> <td>255.255.255.252</td> </tr>
<tr> <td>31</td> <td>255.255.255.254</td> </tr>
<tr> <td>32</td> <td>255.255.255.255</td> </tr>
</tbody></table>
