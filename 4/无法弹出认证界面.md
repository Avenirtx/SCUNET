# 无法弹出认证界面

许多人在人流量较大的教学楼都经历过以下情况：使用Windows10系统连接SCUNET，但是一直连接不上，即使显示连接上，但是仍然无法跳出认证界面。手机则是一直显示无法连接到SCUNET，显示“正在获取ip地址”。

<div align="center">
  <img src="/assets/web认证原理.jpg"/>
  <p>锐捷web认证原理</p>
</div>

无法获取到正确的IP，就没法进行web认证的第一步：发送HTTP请求。那么是什么原因导致了各位连接不上校园网呢？其实原因很简单，是因为IP池中的IP分配完了，所以导致新连接的设备无法取得IP。

但是，当你在这种情况下，找一台已经连接到SCUNET的设备，扫描内网的IP地址，你会发现，许多IP地址都是未分配的状态。甚至有一半的地址都是待分配的状态。这是为什么呢？

为了解释出现这一现象的原因，我们先了解一下获取IP的过程：当你的设备连接SCUNET的时候，会先向DHCP服务器发送请求分配一个IP的报文，当DHCP服务器检查到此时IP池内还有没有分配出去的IP时，就会给你分配一个IP地址，并与你的设备签下一个地址租约，在租约时间内，你的设备拥有该IP地址的使用权，即使你的设备断开连接，只有在租约时间内重新连接，分配的IP就是不变的，别人无法抢占你的IP地址。当租约时间过了一半后如果设备还在线，就会自动发送一次续约报文，请求DHCP服务器将使用权时间延长。

SCUNET的租约时间为2小时，这是在公共场所通用的一个时间配置。但是，教学楼的人实在太多了，并且由于教育场所的特殊性，短时间内交替的流量也十分巨大。

于是问题就跟着来了。在大课间这种即将上课，人流交替的流量很大的时候，许多准备离开教室的人断开了他们的SCUNET，但是由于DHCP租约时间未到，所以他们继续占用着之前分配的IP的使用权，此时，IP池内所剩的可分配IP已经所剩无几，下一波来上课的人已经来到了教室，一部分先采取行动的人抢先连上了SCUNET，于是此时系统最后一点能分配的IP也用完了，即使已经有IP未被分配，但是实际上租约未到期，系统仍然拿不到该IP的使用权，于是就没法为后来的设备分配新IP了，这也就是在你即将上晚课的时候死活连接不上校园网但是等了几十分钟又自己能够连上的原因。从18:25分到19:20仅有55分钟时间，而根据上述所知，几乎所有设备断开网络时的剩余租约都在1小时及以上，抢不到少数还未分配的IP的话，就干等着吧。

**改善这个状况的有效措施就是继续调小SCUNET的租约时间**，但是似乎信息管理中心并没有注意到这个现象，应该也没有人反馈，导致在综C这种大教室教学楼校园网体验很差。

那么有没有什么办法从自己的设备着手解决这种情况呢？有的，手动分配静态IP。也就是说，你给自己的设备手动指定一个合法的IP，强制性的将租约时间未到的设备的IP分配到你的设备（强取）。成功之后你就可以弹出认证界面了，如果仍然无法弹出，浏览器手动输入192.168.2.135即可。

值得注意的是，如果你自行指定的IP地址是正在被使用的IP，那么你将无法强取该IP，也就没法打开认证界面了。不过没关系，靓仔千千万，不行咱就换。一般来说，IP是不可能用完的，一直换到能正常打开为止就行。

网络上已经有大量的设置静态IP的方法，针对自己的系统设置即可。以win10和Android为例：

#### Android
在连接的WiFi名字附近有详情设置按钮，点进去，在IP设置里将DHCP改为手动，然后依次设置你想分配的IP地址、路由器（网关地址）、前缀长度、主DNS、备用DNS地址即可。

<div align="center">
  <img src="/assets/手机静态1.jpg"/>
  <p>Android设置静态IP</p>
</div>

#### Windows10
在连接的WiFi名字右击，点进属性，在IP分配设置里将自动DHCP改为手动，然后依次设置你想分配的IP地址、路由器（网关地址）、前缀长度、主DNS、备用DNS地址即可。

<div align="center">
  <img src="/assets/win静态1.jpg"/>
</div>

<div align="center">
  <img src="/assets/win静态2.jpg"/>
  <p>Windows10设置静态IP</p>
</div>

### 设置参数
- IP地址，在对应大楼的SCUNET子网地址中随机指定，直到能正常打开认证界面为止。
- 子网前缀长度（有的地方是子网掩码）：按照对应大楼的SCUNET参数填写。
- 网关：在对应大楼的SCUNET网关。
- DNS：主DNS:	202.115.32.39 备用：202.115.32.36

### SCUNET参数

以下内容待测试

|地点|路由网关|子网前缀长度|IP地址范围（仅为举例，实际范围并不限于此）|
|:-:|:-:|:-:|:-:|
|寝室|10.132.168.1|21|10.132.168.2-10.132.168.255|
|一教A||21||
|一教B||21||
|一教C||21||
|一教D||21||
|图书馆||21||
|综合楼B座||21||
|综合楼C座||21|10.132..-10.132..255|


.



附录：子网掩码与子网前缀长度对应表：

<table border='0' cellspacing='0' cellpadding='2' width='15%' align='center'>
<tbody> <tr> <td>子网前缀长度</td> <td>子网掩码</td> </tr>
<tr> <td>1</td> <td>128.0.0.0</td> </tr>
<tr> <td>2</td> <td>192.0.0.0</td> </tr>
<tr> <td>3</td> <td>224.0.0.0</td> </tr>
<tr> <td>4</td> <td>240.0.0.0</td> </tr>
<tr> <td>5</td> <td>248.0.0.0</td> </tr>
<tr> <td>6</td> <td>252.0.0.0</td> </tr>
<tr> <td>7</td> <td>254.0.0.0</td> </tr>
<tr> <td>8</td> <td>255.0.0.0</td> </tr>
<tr> <td>9</td> <td>255.128.0.0</td> </tr>
<tr> <td>10</td> <td>255.192.0.0</td> </tr>
<tr> <td>11</td> <td>255.224.0.0</td> </tr>
<tr> <td>12</td> <td>255.240.0.0</td> </tr>
<tr> <td>13</td> <td>255.248.0.0</td> </tr>
<tr> <td>14</td> <td>255.252.0.0</td> </tr>
<tr> <td>15</td> <td>255.254.0.0</td> </tr>
<tr> <td>16</td> <td>255.255.0.0</td> </tr>
<tr> <td>17</td> <td>255.255.128.0</td> </tr>
<tr> <td>18</td> <td>255.255.192.0</td> </tr>
<tr> <td>19</td> <td>255.255.224.0</td> </tr>
<tr> <td>20</td> <td>255.255.240.0</td> </tr>
<tr> <td>21</td> <td>255.255.248.0</td> </tr>
<tr> <td>22</td> <td>255.255.252.0</td> </tr>
<tr> <td>23</td> <td>255.255.254.0</td> </tr>
<tr> <td>24</td> <td>255.255.255.0</td> </tr>
<tr> <td>25</td> <td>255.255.255.128</td> </tr>
<tr> <td>26</td> <td>255.255.255.192</td> </tr>
<tr> <td>27</td> <td>255.255.255.224</td> </tr>
<tr> <td>28</td> <td>255.255.255.240</td> </tr>
<tr> <td>29</td> <td>255.255.255.248</td> </tr>
<tr> <td>30</td> <td>255.255.255.252</td> </tr>
<tr> <td>31</td> <td>255.255.255.254</td> </tr>
<tr> <td>32</td> <td>255.255.255.255</td> </tr>
</tbody></table>
